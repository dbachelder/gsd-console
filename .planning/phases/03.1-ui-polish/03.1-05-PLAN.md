---
phase: 03.1-ui-polish
plan: 05
type: execute
wave: 2
depends_on: ["03.1-04"]
files_modified:
  - src/components/FilePicker.tsx
  - src/components/roadmap/RoadmapView.tsx
  - src/components/phase/PhaseView.tsx
  - src/lib/parser.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "File picker supports arrow key navigation (j/k, up/down)"
    - "File picker supports fuzzy filtering by typing"
    - "Roadmap screen no longer shows misleading project progress bar"
    - "Success criteria checkboxes on phase tab reflect actual completion status"
  artifacts:
    - path: "src/components/FilePicker.tsx"
      provides: "Enhanced file picker with arrow keys and fuzzy filter"
      exports: ["FilePicker"]
    - path: "src/components/roadmap/RoadmapView.tsx"
      provides: "Roadmap view without project progress bar"
      exports: ["RoadmapView"]
    - path: "src/components/phase/PhaseView.tsx"
      provides: "Phase view with accurate success criteria checkboxes"
      exports: ["PhaseView"]
    - path: "src/lib/parser.ts"
      provides: "Parsed success criteria with completion status"
      exports: ["parseContext"]
---

<objective>
Complete UI gap closure for Phase 03.1 - address 3 remaining issues:
1. File picker needs better navigation for >10 files
2. Remove misleading project progress bar from roadmap
3. Fix success criteria checkboxes to reflect actual completion status
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Add arrow key and fuzzy navigation to file picker</name>
  <files>src/components/FilePicker.tsx</files>
  <action>
Enhance FilePicker component with better navigation:

1. **Arrow key navigation:**
   - Add j/k and up/down arrow support via useInput
   - Update selectedIndex on arrow key press
   - Ensure selection wraps or clamps at boundaries

2. **Fuzzy filtering:**
   - Add TextInput from @inkjs/ui for filter input
   - Use @nozbe/microfuzz to filter file list as user types
   - Show filtered list with match count
   - Clear filter with Escape key

3. **Key bindings:**
   - j/k or arrows: Navigate selection
   - Enter: Confirm selected file
   - Escape: Close overlay
   - Type letters: Filter files (show fuzzy input)

Integration pattern:
```tsx
const [filter, setFilter] = useState('');
const [selectedIndex, setSelectedIndex] = useState(0);
const filteredFiles = microfuzz.search(filter, files);

useInput((input, key) => {
  if (key.escape) { onClose?.(); return; }
  if (key.return) { onSelect?.(filteredFiles[selectedIndex]); return; }
  
  if (key.upArrow || input === 'k') {
    setSelectedIndex(Math.max(0, selectedIndex - 1));
  } else if (key.downArrow || input === 'j') {
    setSelectedIndex(Math.min(filteredFiles.length - 1, selectedIndex + 1));
  } else if (input.length === 1 && !key.ctrl && !key.meta) {
    setFilter(filter + input);
  }
}, { isActive });
```
</action>
  <verify>
  Run `bun run dev` and verify:
  1. Press 'e' in roadmap to open file picker
  2. Type letters to filter files
  3. Use j/k to navigate filtered list
  4. Press Enter to select file
  5. Press Escape to close
  </verify>
  <done>FilePicker supports arrow keys and fuzzy filtering</done>
</task>

<task type="auto">
  <name>Task 2: Remove project progress bar from roadmap screen</name>
  <files>src/components/roadmap/RoadmapView.tsx</files>
  <action>
Remove the project progress bar component from RoadmapView:

1. Locate the progress bar component (likely shows plan completion percentage)
2. Remove it from the render tree
3. Ensure phase completion indicators remain visible
4. Adjust layout if needed (reduce height, reposition elements)

Phase completion bars (per-phase progress) should remain intact.
</action>
  <verify>
  Run `bun run dev` and verify:
  1. Open roadmap view
  2. Confirm no project-wide progress bar is shown
  3. Confirm per-phase completion indicators still display
  </verify>
  <done>Project progress bar removed from roadmap view</done>
</task>

<task type="auto">
  <name>Task 3: Fix success criteria checkboxes on phase tab</name>
  <files>src/lib/parser.ts src/components/phase/PhaseView.tsx</files>
  <action>
Investigate and fix success criteria completion tracking:

1. **Investigate GSD tracking mechanism:**
   - Check if VERIFICATION.md tracks individual criteria completion
   - Check if completion is phase-level only (not per-criterion)
   - Review existing parser output for success criteria

2. **Determine completion status:**
   - If phase complete: All criteria marked checked
   - If VERIFICATION.md exists: Check if criteria are individually tracked
   - If neither: Leave unchecked (or show "Not verified")

3. **Update parser (if needed):**
   - Add `completed: boolean` field to each success criterion
   - Parse VERIFICATION.md to extract criterion completion status

4. **Update PhaseView:**
   - Render checkboxes based on `completed` field
   - Use checked state for completed criteria, unchecked otherwise
   - Match styling from plan checkboxes (green checkmark for completed)

Parser update pattern (if tracking individual criteria):
```typescript
export interface SuccessCriterion {
  text: string;
  completed?: boolean;  // NEW
}

// In parseContext, check VERIFICATION.md
const verificationExists = hasVerification(phaseDir);
criteria.forEach(c => {
  c.completed = verificationExists;  // Or parse individual items if available
});
```
</action>
  <verify>
  Run `bun run dev` and verify:
  1. Open a completed phase (e.g., Phase 1, 2, or 3)
  2. Success criteria should show as checked
  3. Open an incomplete phase
  4. Success criteria should show as unchecked
  </verify>
  <done>Success criteria checkboxes reflect actual completion status</done>
</task>

</tasks>

<success_criteria>
- File picker supports arrow key navigation (j/k, up/down)
- File picker supports fuzzy filtering by typing
- Roadmap screen no longer shows project progress bar
- Success criteria checkboxes on phase tab reflect actual completion status
- No regressions in existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/03.1-ui-polish/03.1-05-SUMMARY.md`
</output>

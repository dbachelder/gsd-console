---
phase: 03-actions-and-editing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/hooks/useToast.ts
  - src/hooks/useCommandPalette.ts
  - src/components/toast/Toast.tsx
  - src/components/toast/ToastContainer.tsx
  - src/components/palette/CommandPalette.tsx
  - src/components/palette/CommandItem.tsx
  - src/lib/commands.ts
  - src/app.tsx
autonomous: true

must_haves:
  truths:
    - "User can type : to open command palette"
    - "User can fuzzy search GSD commands"
    - "User sees toast notifications for feedback"
    - "User can press Escape to close palette"
  artifacts:
    - path: "src/hooks/useToast.ts"
      provides: "Toast state management hook"
      exports: ["useToast"]
    - path: "src/hooks/useCommandPalette.ts"
      provides: "Palette visibility and input state"
      exports: ["useCommandPalette"]
    - path: "src/components/palette/CommandPalette.tsx"
      provides: "Fuzzy-filtered command list UI"
      exports: ["CommandPalette"]
    - path: "src/components/toast/ToastContainer.tsx"
      provides: "Toast display and auto-dismiss"
      exports: ["ToastContainer"]
    - path: "src/lib/commands.ts"
      provides: "GSD command definitions"
      exports: ["commands"]
  key_links:
    - from: "src/app.tsx"
      to: "src/hooks/useCommandPalette.ts"
      via: "hook integration"
      pattern: "useCommandPalette"
    - from: "src/components/palette/CommandPalette.tsx"
      to: "@nozbe/microfuzz"
      via: "fuzzy search"
      pattern: "useFuzzySearchList"
---

<objective>
Build toast notification system and command palette with fuzzy search.

Purpose: Create the foundational UI components for user interaction - toast messages provide feedback, command palette provides action discovery.
Output: Working command palette that opens with `:`, filters commands with fuzzy search, and shows toasts on command selection (stubbed execution).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-actions-and-editing/03-CONTEXT.md
@.planning/phases/03-actions-and-editing/03-RESEARCH.md

# Existing code to reference
@src/app.tsx
@src/hooks/useVimNav.ts
@src/components/layout/HelpOverlay.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install microfuzz and create toast hook/components</name>
  <files>package.json, src/hooks/useToast.ts, src/components/toast/Toast.tsx, src/components/toast/ToastContainer.tsx</files>
  <action>
1. Run `bun add @nozbe/microfuzz` to install fuzzy search library

2. Create `src/hooks/useToast.ts`:
   - Toast interface: `{ id: string, message: string, type: 'info' | 'success' | 'warning' }`
   - `useToast(dismissMs = 3000)` hook returns `{ toasts: Toast[], show: (message, type?) => void }`
   - Use setTimeout for auto-dismiss, clear timeout on unmount via useEffect cleanup
   - Generate unique ID with Date.now().toString()

3. Create `src/components/toast/Toast.tsx`:
   - Display single toast with colored icon based on type (info=blue, success=green, warning=yellow)
   - Use Text component with appropriate color

4. Create `src/components/toast/ToastContainer.tsx`:
   - Receives toasts array from useToast
   - Renders Toast components in a Box with absolute positioning (bottom-right)
   - Use `position="absolute"` and appropriate margin from edges
  </action>
  <verify>
    - `bun run typecheck` passes
    - Toast hook can be imported and used
  </verify>
  <done>Toast system ready for integration - hook provides show() function, ToastContainer renders notifications</done>
</task>

<task type="auto">
  <name>Task 2: Create command definitions and palette hook</name>
  <files>src/lib/commands.ts, src/hooks/useCommandPalette.ts</files>
  <action>
1. Create `src/lib/commands.ts`:
   - Define Command interface: `{ name: string, description: string, key?: string, action: (showToast: (msg: string, type?: ToastType) => void) => void }`
   - Export `commands` array with GSD commands:
     - add-todo: "Add a new todo item"
     - add-phase: "Add a new phase to roadmap"
     - insert-phase: "Insert a phase between existing phases"
     - progress: "Update task progress"
     - verify: "Run verification checks"
     - discuss-phase: "Start phase discussion"
     - plan-phase: "Create phase plan"
     - execute-phase: "Execute phase plan"
   - Each action calls showToast with "Will execute when connected to OpenCode" (stubbed)

2. Create `src/hooks/useCommandPalette.ts`:
   - State: mode ('closed' | 'open'), query string, selectedIndex number
   - useInput handler (with isActive based on mode):
     - `:` when closed -> open palette, clear query
     - Escape when open -> close palette
     - Up/Down arrows or j/k when open -> change selectedIndex
     - Enter when open -> execute selected command, close palette
   - Export: `{ mode, query, setQuery, selectedIndex, setSelectedIndex, close, execute }`
   - Note: isActive should disable when mode is 'closed' so main app input works
  </action>
  <verify>
    - `bun run typecheck` passes
    - Commands array exports correctly
    - Hook manages state transitions correctly
  </verify>
  <done>Command definitions and palette state management ready for UI integration</done>
</task>

<task type="auto">
  <name>Task 3: Create CommandPalette component and wire into App</name>
  <files>src/components/palette/CommandPalette.tsx, src/components/palette/CommandItem.tsx, src/app.tsx</files>
  <action>
1. Create `src/components/palette/CommandItem.tsx`:
   - Props: command, isSelected, highlight ranges (optional for fuzzy match highlighting)
   - Display command name and description
   - Use inverse colors or background when selected

2. Create `src/components/palette/CommandPalette.tsx`:
   - Import TextInput from @inkjs/ui
   - Import useFuzzySearchList from @nozbe/microfuzz/react
   - Props: query, onQueryChange, commands, selectedIndex, onSelect, onClose
   - Layout: Box with border, contains TextInput at top, filtered CommandItem list below
   - Use useFuzzySearchList to filter commands based on query
   - TextInput uses onChange (uncontrolled), onSubmit triggers command execution
   - Limit displayed results to 8 items

3. Update `src/app.tsx`:
   - Import useCommandPalette, useToast, CommandPalette, ToastContainer, commands
   - Add useToast() and useCommandPalette() hooks
   - Disable main useInput when palette is open (use isActive: paletteMode === 'closed')
   - Render CommandPalette conditionally when paletteMode === 'open'
   - Render ToastContainer at the end of the main layout
   - Wire command execution to show toast
  </action>
  <verify>
    - `bun run typecheck` passes
    - `bun run lint` passes (run lint:fix if needed)
    - Start app with `bun run dev`, press `:`, type "add", see filtered commands
    - Select command with Enter, see toast notification
    - Press Escape to close palette
  </verify>
  <done>Command palette opens with `:`, shows fuzzy-filtered GSD commands, executes (stubbed) with toast feedback</done>
</task>

</tasks>

<verification>
Run `bun run dev` in the gsd-tui directory:
1. Press `:` - command palette should appear with input field and command list
2. Type "todo" - list should filter to show add-todo
3. Press Enter on selected command - toast should appear saying "Will execute when connected to OpenCode"
4. Toast should auto-dismiss after 3 seconds
5. Press Escape - palette should close
6. Normal navigation (j/k, Tab) should work when palette is closed
</verification>

<success_criteria>
- [x] @nozbe/microfuzz installed and in package.json
- [x] Toast hook provides show() function with auto-dismiss
- [x] ToastContainer renders notifications at screen bottom
- [x] Command palette opens with `:` key
- [x] Fuzzy search filters command list as user types
- [x] Arrow keys or j/k navigate command selection
- [x] Enter executes selected command (shows stub toast)
- [x] Escape closes palette
- [x] Main navigation disabled while palette is open
- [x] `bun run typecheck` passes
- [x] `bun run lint` passes
</success_criteria>

<output>
After completion, create `.planning/phases/03-actions-and-editing/03-01-SUMMARY.md`
</output>

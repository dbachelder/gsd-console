---
phase: 05-test-coverage
plan: 04
type: execute
wave: 4
depends_on: [05-01]
files_modified:
  - test/components/layout/Header.test.tsx
  - test/components/layout/Footer.test.tsx
  - test/components/layout/TabLayout.test.tsx
autonomous: true
must_haves:
  truths:
    - "Header tests pass (renders project name, progress)"
    - "Footer tests pass (renders hints, context-sensitive)"
    - "TabLayout tests pass (tab switching, keyboard navigation)"
  artifacts:
    - path: test/components/layout/Header.test.tsx
      provides: "Header component tests"
      min_lines: 40
    - path: test/components/layout/Footer.test.tsx
      provides: "Footer component tests"
      min_lines: 60
    - path: test/components/layout/TabLayout.test.tsx
      provides: "TabLayout component tests"
      min_lines: 80
  key_links:
    - from: test/components/layout/Header.test.tsx
      to: src/components/layout/Header.tsx
      via: "ink-testing-library render"
      pattern: "render\\(.*Header"
---

<objective>
Add test coverage for layout components (Header, Footer, TabLayout) using ink-testing-library to assert on terminal output.

Purpose: Layout components are the TUI frame. Test that they render correctly with various states (progress values, hints, active tabs). Pattern 1 from 05-RESEARCH.md - render component, capture lastFrame(), assert on text content.

Output: Layout components tested and passing, terminal rendering verified.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/05-test-coverage/05-RESEARCH.md
@src/components/layout/Header.tsx
@src/components/layout/Footer.tsx
@src/components/layout/TabLayout.tsx
@.planning/phases/05-test-coverage/05-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Add Header component tests</name>
  <files>test/components/layout/Header.test.tsx</files>
  <action>
    Create test/components/layout/Header.test.tsx:

    Follow Pattern 1 from 05-RESEARCH.md:

    ```typescript
    import { describe, expect, test } from 'bun:test';
    import { render } from 'ink-testing-library';
    import Header from '../../src/components/layout/Header.tsx';

    describe('Header', () => {
      test('renders project name and progress', () => {
        const { lastFrame } = render(
          <Header
            projectName="GSD Project"
            currentPhase={2}
            totalPhases={4}
            progressPercent={50}
          />
        );

        expect(lastFrame()).toContain('GSD Project');
        expect(lastFrame()).toContain('2 of 4');
        expect(lastFrame()).toContain('50%');
      });

      test('handles 0% progress', () => {
        const { lastFrame } = render(
          <Header
            projectName="Test"
            currentPhase={1}
            totalPhases={5}
            progressPercent={0}
          />
        );

        expect(lastFrame()).toContain('Test');
        expect(lastFrame()).toContain('0%');
      });

      test('handles 100% progress', () => {
        const { lastFrame } = render(
          <Header
            projectName="Complete"
            currentPhase={5}
            totalPhases={5}
            progressPercent={100}
          />
        );

        expect(lastFrame()).toContain('Complete');
        expect(lastFrame()).toContain('100%');
      });
    });
    ```

    Test cases:
    - Renders project name
    - Renders current phase and total phases
    - Renders progress percentage (0%, 50%, 100%)
    - Handles missing/undefined data gracefully
  </action>
  <verify>bun test test/components/layout/Header.test.tsx</verify>
  <done>Header tests pass (project name, phase, progress display)</done>
</task>

<task type="auto">
  <name>Add Footer component tests</name>
  <files>test/components/layout/Footer.test.tsx</files>
  <action>
    Create test/components/layout/Footer.test.tsx:

    Test cases:
    - Renders common hints (q to quit, Tab to switch views)
    - Renders view-specific hints (passed as props)
    - Shows active view name
    - Handles empty hints array
    - Context-sensitive hints (e.g., 'c to connect' only when OpenCode disconnected)

    Based on CLAUDE.md "Context-sensitive footer hints" - verify hints change based on activeView.
  </action>
  <verify>bun test test/components/layout/Footer.test.tsx</verify>
  <done>Footer tests pass (hints display, context-sensitive updates)</done>
</task>

<task type="auto">
  <name>Add TabLayout component tests</name>
  <files>test/components/layout/TabLayout.test.tsx</files>
  <action>
    Create test/components/layout/TabLayout.test.tsx:

    Test cases:
    - Renders all 4 tabs (Roadmap, Phase, Todos, Background)
    - Shows active tab with underline styling
    - Shows inactive tabs with dimColor
    - Renders active tab's child component
    - Handles keyboard navigation via stdin (Tab, 1, 2, 3, 4 keys)
    - Underline styling for active tab (from 03.1-01 decision)

    Use stdin.write() from ink-testing-library to simulate Tab key presses.
    Assert on underline characters or specific text markers in lastFrame().
  </action>
  <verify>bun test test/components/layout/TabLayout.test.tsx</verify>
  <done>TabLayout tests pass (tab rendering, underline, navigation)</done>
</task>

</tasks>

<verification>
Run `bun test test/components/layout/` - all layout tests must pass.
Run `bun test --coverage` - verify layout components have >= 70% coverage.
</verification>

<success_criteria>
- Header tests cover project name, phase info, progress display
- Footer tests cover hints display and context-sensitive updates
- TabLayout tests cover tab rendering, underline styling, navigation
- Layout component coverage >= 70%
- All tests use ink-testing-library render() and lastFrame()
</success_criteria>

<output>
After completion, create `.planning/phases/05-test-coverage/05-04-SUMMARY.md`
</output>

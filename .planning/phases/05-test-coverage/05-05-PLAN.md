---
phase: 05-test-coverage
plan: 05
type: execute
wave: 4
depends_on: [05-01]
files_modified:
  - test/components/roadmap/RoadmapView.test.tsx
  - test/components/roadmap/PhaseRow.test.tsx
  - test/components/roadmap/ProgressBar.test.tsx
autonomous: true
must_haves:
  truths:
    - "RoadmapView tests pass (renders phases, handles expansion)"
    - "PhaseRow tests pass (renders phase info, indicators)"
    - "ProgressBar tests pass (renders progress bars)"
  artifacts:
    - path: test/components/roadmap/RoadmapView.test.tsx
      provides: "RoadmapView component tests"
      min_lines: 80
    - path: test/components/roadmap/PhaseRow.test.tsx
      provides: "PhaseRow component tests"
      min_lines: 60
    - path: test/components/roadmap/ProgressBar.test.tsx
      provides: "ProgressBar component tests"
      min_lines: 40
  key_links:
    - from: test/components/roadmap/RoadmapView.test.tsx
      to: src/components/roadmap/RoadmapView.tsx
      via: "ink-testing-library render"
      pattern: "render\\(.*RoadmapView"
---

<objective>
Add test coverage for roadmap components (RoadmapView, PhaseRow, ProgressBar) using ink-testing-library.

Purpose: Roadmap is the main TUI view - critical for user navigation. Test rendering of phase list, expansion state, and progress visualization. Use ink-testing-library for terminal output assertions.

Output: Roadmap components tested and passing, phase display and navigation verified.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/05-test-coverage/05-RESEARCH.md
@src/components/roadmap/RoadmapView.tsx
@src/components/roadmap/PhaseRow.tsx
@src/components/roadmap/ProgressBar.tsx
@.planning/phases/05-test-coverage/05-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Add RoadmapView component tests</name>
  <files>test/components/roadmap/RoadmapView.test.tsx</files>
  <action>
    Create test/components/roadmap/RoadmapView.test.tsx:

    Test cases:
    - Renders phase list with phase names
    - Shows phase status (done, in-progress, not-started)
    - Expands phase when in expandedPhases set
    - Collapses phase when not in expandedPhases set
    - Handles empty phases array
    - Handles phase with no goal (graceful degradation)
    - Shows visual indicators (has plan, has context, etc.)

    Use mock phases array:
    ```typescript
    const mockPhases = [
      { number: 1, name: 'Core TUI', status: 'done', goal: 'Build TUI', plansTotal: 4, plansComplete: 4 },
      { number: 2, name: 'Real-time Updates', status: 'in-progress', goal: 'Watch files', plansTotal: 3, plansComplete: 1 },
    ];
    ```

    Test with expandedPhases as Set([1]) to verify Phase 1 renders goal, success criteria, etc.
  </action>
  <verify>bun test test/components/roadmap/RoadmapView.test.tsx</verify>
  <done>RoadmapView tests pass (phase list, expansion, status display)</done>
</task>

<task type="auto">
  <name>Add PhaseRow component tests</name>
  <files>test/components/roadmap/PhaseRow.test.tsx</files>
  <action>
    Create test/components/roadmap/PhaseRow.test.tsx:

    Test cases:
    - Renders phase name and number
    - Shows status indicator (checkmark for done, progress for in-progress)
    - Shows progress bars (plansComplete/plansTotal)
    - Shows visual indicators (plan, context, research, UAT icons)
    - Handles collapsed state (minimal info)
    - Handles expanded state (goal, requirements, success criteria)

    Based on CLAUDE.md "All 4 indicator slots always shown, inactive ones use dimColor" decision.
    Verify indicators render correctly with dimColor for missing items.
  </action>
  <verify>bun test test/components/roadmap/PhaseRow.test.tsx</verify>
  <done>PhaseRow tests pass (phase info, indicators, progress bars)</done>
</task>

<task type="auto">
  <name>Add ProgressBar component tests</name>
  <files>test/components/roadmap/ProgressBar.test.tsx</files>
  <action>
    Create test/components/roadmap/ProgressBar.test.tsx:

    Test cases:
    - Renders progress bar with correct percentage (0%, 50%, 100%)
    - Handles integer completion (e.g., 3/10 = 30%)
    - Shows completion text (e.g., "3/10")
    - Handles 0/0 (graceful - no divide by zero)
    - Handles edge cases (0/10, 10/10)

    Based on CLAUDE.md "Progress bar shows phase completion (not plan-based)" decision.
  </action>
  <verify>bun test test/components/roadmap/ProgressBar.test.tsx</verify>
  <done>ProgressBar tests pass (percentage rendering, completion text)</done>
</task>

</tasks>

<verification>
Run `bun test test/components/roadmap/` - all roadmap tests must pass.
Run `bun test --coverage` - verify roadmap components have >= 75% coverage.
</verification>

<success_criteria>
- RoadmapView tests cover phase list rendering and expansion
- PhaseRow tests cover status indicators, progress, phase info
- ProgressBar tests cover percentage calculation and rendering
- Roadmap component coverage >= 75%
- All tests use ink-testing-library render() and lastFrame()
</success_criteria>

<output>
After completion, create `.planning/phases/05-test-coverage/05-05-SUMMARY.md`
</output>

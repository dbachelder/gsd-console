---
phase: 05-test-coverage
plan: 08
type: execute
wave: 6
depends_on: [05-03, 05-05]
files_modified:
  - test/components/palette/CommandPalette.test.tsx
  - test/components/palette/CommandItem.test.tsx
  - test/components/picker/FilePicker.test.tsx
  - test/components/picker/SessionPicker.test.tsx
autonomous: true
must_haves:
  truths:
    - "CommandPalette tests pass (fuzzy search, keyboard navigation)"
    - "CommandItem tests pass (renders command, handles selection)"
    - "FilePicker tests pass (file list, multi-select)"
    - "SessionPicker tests pass (session list, connection)"
  artifacts:
    - path: test/components/palette/CommandPalette.test.tsx
      provides: "Command palette component tests"
      min_lines: 80
    - path: test/components/palette/CommandItem.test.tsx
      provides: "Command item component tests"
      min_lines: 40
    - path: test/components/picker/FilePicker.test.tsx
      provides: "File picker component tests"
      min_lines: 60
    - path: test/components/picker/SessionPicker.test.tsx
      provides: "Session picker component tests"
      min_lines: 50
  key_links:
    - from: test/components/palette/CommandPalette.test.tsx
      to: src/components/palette/CommandPalette.tsx
      via: "ink-testing-library render"
      pattern: "render\\(.*CommandPalette"
---

<objective>
Add test coverage for command palette and picker components (CommandPalette, CommandItem, FilePicker, SessionPicker).

Purpose: These are interactive components with fuzzy search and keyboard navigation. Test that they render correctly, filter commands/sessions, and handle keyboard input. Uses ink-testing-library's stdin simulation.

Output: Command palette and pickers tested, fuzzy search and navigation verified.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/05-test-coverage/05-RESEARCH.md
@src/components/palette/CommandPalette.tsx
@src/components/palette/CommandItem.tsx
@src/components/picker/FilePicker.tsx
@src/components/picker/SessionPicker.tsx
@.planning/phases/05-test-coverage/05-03-SUMMARY.md
@.planning/phases/05-test-coverage/05-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Add CommandPalette component tests</name>
  <files>test/components/palette/CommandPalette.test.tsx</files>
  <action>
    Create test/components/palette/CommandPalette.test.tsx:

    Test cases:
    - Renders command list
    - Filters commands with fuzzy search (@nozbe/microfuzz)
    - Handles keyboard navigation (j/k to move, Enter to select, Escape to close)
    - Shows filtered commands as user types
    - Shows no results message when search matches nothing
    - Handles Tab completion for arguments (from 04-07 decision)

    Use mock commands array:
    ```typescript
    const mockCommands = [
      { id: 'add-todo', name: 'add-todo', description: 'Add a new todo' },
      { id: 'progress', name: 'progress', description: 'Update phase progress' },
    ];
    ```

    Simulate keyboard input with stdin.write() from ink-testing-library.
  </action>
  <verify>bun test test/components/palette/CommandPalette.test.tsx</verify>
  <done>CommandPalette tests pass (rendering, fuzzy search, navigation)</done>
</task>

<task type="auto">
  <name>Add CommandItem component tests</name>
  <files>test/components/palette/CommandItem.test.tsx</files>
  <action>
    Create test/components/palette/CommandItem.test.tsx:

    Test cases:
    - Renders command name and description
    - Shows active highlight when selected
    - Handles keyboard shortcut display (if any)
    - Triggers onSelect callback on Enter key
    - Triggers onSelect callback on click (if clickable)

    Based on CLAUDE.md "Command palette" feature - shows command list with descriptions.
  </action>
  <verify>bun test test/components/palette/CommandItem.test.tsx</verify>
  <done>CommandItem tests pass (rendering, selection, callback)</done>
</task>

<task type="auto">
  <name>Add FilePicker component tests</name>
  <files>test/components/picker/FilePicker.test.tsx</files>
  <action>
    Create test/components/picker/FilePicker.test.tsx:

    Test cases:
    - Renders file list
    - Handles multi-select (Space to toggle selection)
    - Shows selected files with checkmark
    - Filters files with fuzzy search
    - Handles keyboard navigation (j/k, Enter to confirm, Escape to cancel)
    - Returns selected file list on confirm

    Based on CLAUDE.md "FilePicker (e key, multi-file selection for editor)" feature.
  </action>
  <verify>bun test test/components/picker/FilePicker.test.tsx</verify>
  <done>FilePicker tests pass (file list, multi-select, fuzzy search)</done>
</task>

<task type="auto">
  <name>Add SessionPicker component tests</name>
  <files>test/components/picker/SessionPicker.test.tsx</files>
  <action>
    Create test/components/picker/SessionPicker.test.tsx:

    Test cases:
    - Renders session list with titles
    - Shows working directory for each session
    - Filters sessions by directory tree (from 04-03 decision)
    - Handles keyboard navigation (j/k, Enter to select, Escape to cancel)
    - Shows "No sessions available" message
    - Returns selected session on confirm

    Use mock sessions:
    ```typescript
    const mockSessions = [
      { id: 's1', title: 'Working on Phase 1', workingDirectory: '/Users/dan/src/gsd-tui' },
      { id: 's2', title: 'Different project', workingDirectory: '/Users/dan/other' },
    ];
    ```

    Based on CLAUDE.md "Session picker and connect command" feature.
  </action>
  <verify>bun test test/components/picker/SessionPicker.test.tsx</verify>
  <done>SessionPicker tests pass (session list, directory filtering, selection)</done>
</task>

</tasks>

<verification>
Run `bun test test/components/palette/ test/components/picker/` - all picker/palette tests must pass.
Run `bun test --coverage` - verify picker components have >= 70% coverage.
</verification>

<success_criteria>
- CommandPalette tests cover rendering, fuzzy search, keyboard navigation
- CommandItem tests cover selection and callback triggering
- FilePicker tests cover multi-select, fuzzy search, navigation
- SessionPicker tests cover session display, directory filtering
- Picker/palette component coverage >= 70%
- All tests use stdin.write() for keyboard simulation
</success_criteria>

<output>
After completion, create `.planning/phases/05-test-coverage/05-08-SUMMARY.md`
</output>

---
phase: 01-core-tui
plan: 03
type: execute
wave: 1
depends_on: ["01-02"]
files_modified:
  - src/hooks/useGsdData.ts
  - src/app.tsx
  - src/components/roadmap/PhaseRow.tsx
  - src/lib/icons.ts
  - src/lib/parser.ts
  - src/components/layout/TabLayout.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Progress bar shows phase-based progress (1/4 = 25%), not plan-based"
    - "Pressing q exits the TUI and returns to shell immediately"
    - "Phase progress bars are right-aligned with '{n}/{m}' format (no 'plans' text)"
    - "Phase indicator icons have text labels (e.g., 'üìù Plan')"
    - "Success criteria checkboxes are consistently aligned"
    - "--only mode fills the terminal pane height"
  artifacts:
    - path: "src/hooks/useGsdData.ts"
      provides: "Phase-based progress calculation"
    - path: "src/app.tsx"
      provides: "Clean exit with process.exit(0)"
---

<objective>
Fix 6 UAT issues from Phase 1 testing: 2 major (progress bar, q exit) and 4 cosmetic (alignment, labels, layout).

Purpose: Address user-reported issues to complete Phase 1 verification.

Output: All 6 issues fixed, ready for re-verification.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01-core-tui/01-UAT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix progress calculation and q exit (major issues)</name>
  <files>
    - src/hooks/useGsdData.ts
    - src/app.tsx
  </files>
  <action>
Fix the two major issues reported in UAT.

1. Fix progress calculation in src/hooks/useGsdData.ts:

   Current code calculates progress based on completed plans / total plans, but phases with "TBD" plans count as 0, making progress show 100% when only phase 1 is done.

   Change the progress calculation (around lines 87-95) to use phase-based progress:
   ```typescript
   // Calculate progress based on completed phases, not plans
   const completedPhases = phases.filter(p => p.status === 'complete').length;
   state = {
     ...state,
     progressPercent: phases.length > 0
       ? Math.round((completedPhases / phases.length) * 100)
       : 0,
   };
   ```

   This gives 25% per phase (1/4 = 25%, 2/4 = 50%, etc.)

2. Fix q exit in src/app.tsx:

   Current code calls `exit()` from `useApp()` which unmounts React but doesn't terminate the Bun process.

   Update the q key handler (around line 35-37):
   ```typescript
   if (input === 'q') {
     exit();
     process.exit(0);
   }
   ```
  </action>
  <verify>
    - Run `bun run dev`, verify progress shows 25% (1 of 4 phases complete)
    - Press q, verify app exits immediately back to shell
  </verify>
  <done>Progress bar shows phase-based percentage. q key exits cleanly to shell.</done>
</task>

<task type="auto">
  <name>Task 2: Fix phase row layout and icon labels (cosmetic)</name>
  <files>
    - src/components/roadmap/PhaseRow.tsx
    - src/lib/icons.ts
  </files>
  <action>
Fix cosmetic issues in phase row display.

1. Right-align progress and remove "plans" text in PhaseRow.tsx:

   Restructure the main row Box to use justifyContent="space-between":
   ```tsx
   <Box justifyContent="space-between">
     {/* Left side: chevron, status, name */}
     <Box>
       <Text>{chevron} </Text>
       <Text color={statusColor}>[{statusIcon}] </Text>
       <Text bold={isSelected}>Phase {phase.number}: {phase.name}</Text>
     </Box>

     {/* Right side: progress bar and count */}
     <Box>
       <ProgressBar percent={planPercent} width={10} showPercent={false} />
       <Text dimColor> {phase.plansComplete}/{phase.plansTotal}</Text>
     </Box>
   </Box>
   ```

2. Add text labels to indicator icons in icons.ts:

   Update getIndicatorIcons() to return labeled strings:
   ```typescript
   export function getIndicatorIcons(indicators: {
     hasContext: boolean;
     hasPlan: boolean;
     hasResearch: boolean;
     needsVerification: boolean;
   }): string {
     const parts: string[] = [];

     if (indicators.hasResearch) parts.push(`${icons.hasResearch} Research`);
     if (indicators.hasContext) parts.push(`${icons.hasContext} Context`);
     if (indicators.hasPlan) parts.push(`${icons.hasPlan} Plan`);
     if (indicators.needsVerification) parts.push(`${icons.needsVerification} Verify`);

     return parts.join('  ');
   }
   ```
  </action>
  <verify>
    - Run `bun run dev`, verify progress bars are right-aligned
    - Verify plan count shows "2/2" not "2/2 plans"
    - Expand a phase with l, verify icons have labels like "üìù Plan"
  </verify>
  <done>Progress bars right-aligned with concise format. Indicator icons have text labels.</done>
</task>

<task type="auto">
  <name>Task 3: Fix checkbox alignment and --only mode height (cosmetic)</name>
  <files>
    - src/lib/parser.ts
    - src/components/layout/TabLayout.tsx
  </files>
  <action>
Fix remaining cosmetic issues.

1. Fix checkbox alignment by trimming whitespace in parser.ts:

   In parseRoadmap(), update the success criteria extraction (around line 52):
   ```typescript
   const text = line.replace(/^\d+\.\s+/, '').trim();
   ```

   The .trim() is already there, but the issue is the line capture. Update the regex to also trim:
   ```typescript
   if (criteriaLines) {
     for (const line of criteriaLines) {
       const text = line.replace(/^\s*\d+\.\s+/, '').trim();
       if (text) successCriteria.push(text);
     }
   }
   ```

2. Fix --only mode to fill terminal in TabLayout.tsx:

   Update the single view mode Box (around line 52-68) to add flexGrow:
   ```tsx
   if (flags.only) {
     return (
       <Box flexDirection="column" flexGrow={1}>
         {/* ... view content ... */}
       </Box>
     );
   }
   ```

   Also add flexGrow to the main app.tsx container if needed.
  </action>
  <verify>
    - Run `bun run dev`, go to Phase tab, verify all checkboxes are aligned
    - Run `bun start --only roadmap`, verify it fills the terminal pane
  </verify>
  <done>Success criteria checkboxes aligned. --only mode fills terminal.</done>
</task>

</tasks>

<verification>
After completing all tasks, re-run the failing UAT tests:

1. Test 2: Progress bar - should show 25% (1/4 phases)
2. Test 5: Phase list - progress bars right-aligned, no "plans" text
3. Test 6: Phase expand - icons have labels
4. Test 9: Phase details - checkboxes aligned
5. Test 15: q key - exits cleanly to shell
6. Test 17: --only mode - fills terminal
</verification>

<success_criteria>
- All 6 UAT issues fixed
- Linting passes
- TypeScript compiles
- Ready for UAT re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-tui/01-03-SUMMARY.md`
</output>

---
phase: 01-core-tui
plan: 04
type: execute
wave: 1
depends_on: [01-03]
files_modified:
  - src/components/roadmap/RoadmapView.tsx
  - src/lib/icons.ts
  - src/components/phase/CriteriaList.tsx
  - src/components/phase/PhaseView.tsx
  - src/components/todos/TodosView.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "l key expands/collapses phases, Enter navigates to Phase tab"
    - "Unstarted phases show placeholder indicators with faded styling"
    - "Success criteria items are consistently aligned regardless of text length"
    - "--only mode fills the terminal pane height"
  artifacts:
    - path: "src/components/roadmap/RoadmapView.tsx"
      provides: "Separated expand vs navigate behavior"
      contains: "key.return.*onSelectPhase"
    - path: "src/lib/icons.ts"
      provides: "Placeholder indicators for inactive states"
      contains: "dimColor"
    - path: "src/components/phase/CriteriaList.tsx"
      provides: "Single-Text checkbox layout"
      contains: "template literal with checkbox"
  key_links:
    - from: "RoadmapView.tsx"
      to: "useVimNav onSelect"
      via: "toggleExpand only"
      pattern: "onSelect.*toggleExpand"
---

<objective>
Fix 3 remaining UAT issues: l-key behavior, placeholder indicators, and layout consistency.

Purpose: Complete Phase 1 UAT with all issues resolved
Output: Polished TUI with correct keybindings, placeholder indicators, and consistent layout
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-tui/01-03-SUMMARY.md
@.planning/debug/roadmap-l-key-expands-phase.md
@.planning/debug/only-mode-height.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Separate expand from navigate in RoadmapView</name>
  <files>src/components/roadmap/RoadmapView.tsx</files>
  <action>
Modify the useVimNav onSelect callback in RoadmapView.tsx (lines 67-74):

Current behavior: l/Enter/rightArrow all call onSelect which toggles expansion AND navigates to Phase tab if already expanded.

New behavior:
- onSelect (l key, right arrow) should ONLY toggle expansion, never navigate
- Add separate useInput handler for Enter key that navigates to Phase tab

Changes needed:
1. Remove the navigation logic from onSelect callback (lines 70-73)
2. Add a new useInput handler that listens for Enter key:
   - When Enter is pressed and the selected phase is expanded, call onSelectPhase
   - Only call onSelectPhase if onSelectPhase is defined

The onSelect callback should become:
```typescript
onSelect: () => {
  toggleExpand(selectedIndex);
},
```

Add new useInput handler after the existing d-key handler:
```typescript
useInput(
  (input, key) => {
    if (key.return) {
      const phase = phases[selectedIndex];
      if (phase && expandedPhases.has(phase.number)) {
        onSelectPhase?.(phase.number);
      }
    }
  },
  { isActive },
);
```
  </action>
  <verify>
Run `bun start --only roadmap`:
- Press l on a phase: should expand/collapse only
- Press l again on expanded phase: should collapse, NOT switch tabs
- Press Enter on expanded phase: should switch to Phase tab
  </verify>
  <done>l key only expands/collapses, Enter navigates to Phase tab</done>
</task>

<task type="auto">
  <name>Task 2: Add placeholder indicators for unstarted phases</name>
  <files>src/lib/icons.ts</files>
  <action>
Modify getIndicatorIcons() in icons.ts to show ALL indicators with dimmed styling for inactive ones.

Current behavior: Only shows icons for true indicators, returns empty string if all false.

New behavior: Always show all 4 indicators. Active indicators are bright, inactive are dimmed (using empty square icon).

Changes needed:

1. Add placeholder icon to icons object:
```typescript
placeholder: '\u25A1', // Empty square (for inactive indicators)
```

2. Replace getIndicatorIcons function with version that returns structured data for rendering:
```typescript
export interface IndicatorState {
  research: boolean;
  context: boolean;
  plan: boolean;
  verify: boolean;
}

export function getIndicatorIcons(indicators: {
  hasContext: boolean;
  hasPlan: boolean;
  hasResearch: boolean;
  needsVerification: boolean;
}): { icon: string; label: string; active: boolean }[] {
  return [
    {
      icon: indicators.hasResearch ? icons.hasResearch : icons.placeholder,
      label: 'Research',
      active: indicators.hasResearch
    },
    {
      icon: indicators.hasContext ? icons.hasContext : icons.placeholder,
      label: 'Context',
      active: indicators.hasContext
    },
    {
      icon: indicators.hasPlan ? icons.hasPlan : icons.placeholder,
      label: 'Plan',
      active: indicators.hasPlan
    },
    {
      icon: indicators.needsVerification ? icons.needsVerification : icons.placeholder,
      label: 'Verify',
      active: indicators.needsVerification
    },
  ];
}
```

3. Update PhaseRow.tsx to render the new structure:
Import Text from ink, then render indicators with conditional dimColor:
```typescript
const indicators = getIndicatorIcons(phase.indicators);
// In render:
{showIndicators && (
  <Box>
    {indicators.map((ind, i) => (
      <Text key={ind.label} dimColor={!ind.active}>
        {ind.icon} {ind.label}{i < indicators.length - 1 ? '  ' : ''}
      </Text>
    ))}
  </Box>
)}
```

4. Update PhaseView.tsx to handle the new array return type:
```typescript
const indicators = getIndicatorIcons(phase.indicators);
const hasActiveIndicators = indicators.some(ind => ind.active);
// In render, show indicators line only if any are active:
{hasActiveIndicators && (
  <Box>
    <Text dimColor>Indicators: </Text>
    {indicators.filter(ind => ind.active).map((ind, i, arr) => (
      <Text key={ind.label}>{ind.icon} {ind.label}{i < arr.length - 1 ? '  ' : ''}</Text>
    ))}
  </Box>
)}
```
  </action>
  <verify>
Run `bun start --only roadmap`:
- Press d to show indicators
- Unstarted phases show all 4 placeholders (empty squares) with faded text
- In-progress/complete phases show bright icons for active indicators, faded for inactive
  </verify>
  <done>All phases show 4 indicator slots, inactive ones use placeholder icon with dimColor</done>
</task>

<task type="auto">
  <name>Task 3: Fix checkbox alignment and --only mode height</name>
  <files>
    src/components/phase/CriteriaList.tsx
    src/components/roadmap/RoadmapView.tsx
    src/components/phase/PhaseView.tsx
    src/components/todos/TodosView.tsx
  </files>
  <action>
Two separate fixes:

**Fix 1: CriteriaList checkbox alignment**

Replace the multi-Text Box approach with a single Text component using template literal.

Current (line 26-30):
```tsx
<Box key={index}>
  <Text dimColor>{index + 1}. </Text>
  <Text color="gray">[ ] </Text>
  <Text wrap="wrap">{criterion}</Text>
</Box>
```

New:
```tsx
<Text key={index} wrap="wrap">
  <Text dimColor>{index + 1}. </Text>
  <Text color="gray">[ ] </Text>
  {criterion}
</Text>
```

This keeps all parts in a single Text flow, ensuring consistent spacing when text wraps.

**Fix 2: --only mode height**

Add flexGrow={1} to the root Box of all three view components:

1. RoadmapView.tsx line 94:
   Change: `<Box flexDirection="column" paddingX={1}>`
   To: `<Box flexDirection="column" paddingX={1} flexGrow={1}>`

2. PhaseView.tsx line 98:
   Change: `<Box flexDirection="column" paddingX={1}>`
   To: `<Box flexDirection="column" paddingX={1} flexGrow={1}>`

3. TodosView.tsx line 61:
   Change: `<Box flexDirection="column" paddingX={1}>`
   To: `<Box flexDirection="column" paddingX={1} flexGrow={1}>`
  </action>
  <verify>
For checkbox alignment:
- Run `bun start`, go to Phase tab, check success criteria
- All criteria items should have consistent alignment (no leading space on items 3, 4)

For --only mode height:
- Run `bun start --only roadmap`
- View should fill terminal height (not just content-sized)
  </verify>
  <done>Criteria checkboxes consistently aligned, --only mode fills terminal</done>
</task>

</tasks>

<verification>
All three UAT issues resolved:
1. `bun start --only roadmap` - press l twice on same phase, should toggle expand/collapse, NOT switch tabs
2. `bun start --only roadmap` - unstarted phases show placeholder indicators with faded styling
3. `bun start` - Phase tab success criteria are consistently aligned
4. `bun start --only roadmap` - view fills terminal pane height
</verification>

<success_criteria>
- l key expands/collapses phases only, Enter navigates to Phase tab
- All phases show 4 indicator slots (bright when active, faded placeholder when inactive)
- Success criteria checkboxes have consistent alignment across all items
- --only mode fills terminal height
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-tui/01-04-SUMMARY.md`
</output>

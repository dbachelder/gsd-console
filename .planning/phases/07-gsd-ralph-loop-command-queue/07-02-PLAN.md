---
phase: 07-gsd-ralph-loop-command-queue
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [src/components/queue/WorkQueueView.tsx, src/components/queue/QueueEntry.tsx]
autonomous: true

must_haves:
  truths:
    - "Queue list displays all commands with status icons"
    - "Each command shows status icon, command text, and optional args"
    - "Empty queue shows helpful message"
  artifacts:
    - path: "src/components/queue/QueueEntry.tsx"
      provides: "Single queue item rendering with status icon"
      min_lines: 30
    - path: "src/components/queue/WorkQueueView.tsx"
      provides: "Queue list view with Vim navigation"
      min_lines: 50
  key_links:
    - from: "src/components/queue/QueueEntry.tsx"
      to: "src/lib/types.ts"
      via: "import QueuedCommand"
      pattern: "import.*QueuedCommand.*from.*types"
    - from: "src/components/queue/WorkQueueView.tsx"
      to: "src/hooks/useVimNav.ts"
      via: "useVimNav hook"
      pattern: "useVimNav.*{"
---

<objective>
Create WorkQueueView component with QueueEntry for displaying user-managed command queue.

Purpose: Build UI for queue display with status icons (pending ○, running ◐, completed ✓, failed ✗) and Vim-style navigation following established patterns from Phase 4's BackgroundView.
Output: WorkQueueView and QueueEntry components for queue tab.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-gsd-ralph-loop-command-queue/07-CONTEXT.md
@.planning/phases/07-gsd-ralph-loop-command-queue/07-RESEARCH.md
@src/lib/types.ts
@src/components/background/BackgroundView.tsx
@src/components/background/JobEntry.tsx
@src/hooks/useVimNav.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create QueueEntry component</name>
  <files>src/components/queue/QueueEntry.tsx</files>
  <action>
    Create src/components/queue/QueueEntry.tsx following JobEntry.tsx pattern:

    ```typescript
    /**
     * QueueEntry Component
     * Renders a single queued command with status icon.
     */

    import { Box, Text } from 'ink';
    import type { QueuedCommand } from '../../lib/types.ts';

    interface QueueEntryProps {
      command: QueuedCommand;
      isSelected: boolean;
    }

    /** Get status icon and color for command */
    function getStatusIcon(status: QueuedCommand['status']): { icon: string; color: string } {
      switch (status) {
        case 'pending': return { icon: '○', color: 'gray' };
        case 'running': return { icon: '◐', color: 'cyan' };
        case 'complete': return { icon: '✓', color: 'green' };
        case 'failed': return { icon: '✗', color: 'red' };
      }
    }

    export function QueueEntry({ command, isSelected }: QueueEntryProps) {
      const { icon, color } = getStatusIcon(command.status);

      return (
        <Box>
          <Text color={color} bold={isSelected}>
            {icon}{' '}
          </Text>
          <Text bold={isSelected}>
            {command.command}
          </Text>
          {command.args && (
            <Text dimColor> {command.args}</Text>
          )}
        </Box>
      );
    }

    export default QueueEntry;
    ```

    Use hollow circle (○) for pending, half-filled (◐) for running, checkmark (✓) for complete, X (✗) for failed per RESEARCH.md recommendation.
  </action>
  <verify>grep "getStatusIcon" src/components/queue/QueueEntry.tsx && grep "export function QueueEntry" src/components/queue/QueueEntry.tsx</verify>
  <done>QueueEntry component renders status icons and command text</done>
</task>

<task type="auto">
  <name>Task 2: Create WorkQueueView component</name>
  <files>src/components/queue/WorkQueueView.tsx</files>
  <action>
    Create src/components/queue/WorkQueueView.tsx following BackgroundView.tsx pattern:

    ```typescript
    /**
     * WorkQueueView Component
     * Displays user-managed GSD command queue with Vim navigation.
     */

    import { Box, Static, Text } from 'ink';
    import { useCallback } from 'react';
    import { useVimNav } from '../../hooks/useVimNav.ts';
    import type { QueuedCommand } from '../../lib/types.ts';
    import { QueueEntry } from './QueueEntry.tsx';

    interface WorkQueueViewProps {
      queue: QueuedCommand[];
      isActive?: boolean;
      onQueueRemove?: (id: string) => void;
      showToast?: (message: string, type?: 'info' | 'success' | 'warning') => void;
    }

    export function WorkQueueView({
      queue,
      isActive = true,
      onQueueRemove,
      showToast,
    }: WorkQueueViewProps) {
      const nav = useVimNav({
        itemCount: queue.length,
        pageSize: 10,
        isActive,
        onSelect: () => {
          // Remove selected command on Enter
          if (nav.selectedIndex < queue.length && onQueueRemove) {
            const command = queue[nav.selectedIndex];
            onQueueRemove(command.id);
            showToast?.(`Removed: ${command.command}`, 'info');
          }
        },
      });

      if (queue.length === 0) {
        return (
          <Box padding={2}>
            <Text dimColor>No commands in queue</Text>
            <Text dimColor> Press 'w' in Roadmap or Phase tab to add commands</Text>
          </Box>
        );
      }

      // Calculate visible range
      const endIndex = Math.min(nav.scrollOffset + 10, queue.length);
      const visibleCommands = queue.slice(nav.scrollOffset, endIndex);

      return (
        <Box flexDirection="column">
          <Static items={visibleCommands.map((command, index) => {
            const absoluteIndex = nav.scrollOffset + index;
            const isSelected = absoluteIndex === nav.selectedIndex;
            return (
              <Box key={command.id}>
                <QueueEntry command={command} isSelected={isSelected} />
              </Box>
            );
          })} />
        </Box>
      );
    }

    export default WorkQueueView;
    ```

    Use Static component for scrollable content (per BackgroundView pattern).
  </action>
  <verify>grep "export function WorkQueueView" src/components/queue/WorkQueueView.tsx && grep "useVimNav" src/components/queue/WorkQueueView.tsx</verify>
  <done>WorkQueueView renders queue list with Vim navigation and empty state</done>
</task>

</tasks>

<verification>
- QueueEntry displays status icons (○, ◐, ✓, ✗)
- QueueEntry shows command text and optional args
- WorkQueueView uses useVimNav for j/k navigation
- WorkQueueView shows empty state message when queue empty
- WorkQueueView uses Static component for scrollable content
</verification>

<success_criteria>
- Queue displays with status icons
- Vim navigation works (j/k, gg/G, Ctrl+d/u)
- Empty queue shows helpful message
- Enter removes selected command
</success_criteria>

<output>
After completion, create `.planning/phases/07-gsd-ralph-loop-command-queue/07-02-SUMMARY.md`
</output>
